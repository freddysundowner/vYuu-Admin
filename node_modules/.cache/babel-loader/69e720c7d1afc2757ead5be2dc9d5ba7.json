{"ast":null,"code":"import{useContext,useEffect,useState,setArray}from\"react\";import{useForm}from\"react-hook-form\";import{SidebarContext}from\"../context/SidebarContext\";import ProductServices from\"../services/ProductServices\";import{notifyError,notifySuccess}from\"../utils/toast\";const useProductSubmit=id=>{const[imageUrl,setImageUrl]=useState([]);const[children,setChildren]=useState(\"\");const[productdata,setProductData]=useState(null);const[toUpdate,setToUpdate]=useState(false);const[tag,setTag]=useState([]);const[variations,setVariations]=useState([]);const{isDrawerOpen,closeDrawer,setIsUpdate,files,setFiles}=useContext(SidebarContext);const{register,handleSubmit,watch,setValue,clearErrors,formState:{errors}}=useForm();const updateProductImages=(files,id)=>{ProductServices.updateProduct(id,{images:files}).then(res=>{setIsUpdate(true);notifySuccess(res.message);}).catch(err=>notifyError(err.message));};const onSubmit=data=>{if(data.discountedPrice<data.salePrice){notifyError(\"SalePrice must be less then or equal of product price!\");return;}_updateAddProduct(data);};const _updateAddProduct=data=>{const productData={sku:data.sku,name:data.title,description:data.description,category:Array.from(new Set(tag.flatMap(x=>x.name.split(\", \")))),quantity:data.quantity,price:data.salePrice?data.salePrice:data.originalPrice,discountedPrice:data.discountedPrice==undefined?0:data.discountedPrice};if(id){ProductServices.updateProduct(id,productData).then(res=>{setIsUpdate(true);notifySuccess(\"product updated\");}).catch(err=>notifyError(err.message));closeDrawer();}else{ProductServices.addProduct(productData).then(res=>{setIsUpdate(true);notifySuccess(\"product added\");}).catch(err=>notifyError(err.message));closeDrawer();}};useEffect(()=>{if(!isDrawerOpen){setValue(\"sku\");setValue(\"title\");setValue(\"slug\");setValue(\"description\");setValue(\"parent\");setValue(\"children\");setValue(\"type\");setValue(\"unit\");setValue(\"quantity\");setValue(\"originalPrice\");setValue(\"salePrice\");setImageUrl(\"\");setChildren(\"\");// setTag([]);\nclearErrors(\"sku\");clearErrors(\"title\");clearErrors(\"slug\");clearErrors(\"description\");clearErrors(\"parent\");clearErrors(\"children\");clearErrors(\"type\");clearErrors(\"unit\");clearErrors(\"quantity\");clearErrors(\"originalPrice\");clearErrors(\"salePrice\");clearErrors(\"tax1\");clearErrors(\"tax2\");return;}if(id){ProductServices.getProductById(id).then(res=>{console.log(res);if(res){var categories=[];res.interest.forEach((v,k)=>{categories.push({id:v._id,name:v.name});});setValue(\"sku\",res._id.substring(18,26));setValue(\"title\",res.name);setValue(\"id\",res._id);// setValue('slug', res.slug);\nsetValue(\"description\",res.description);setValue(\"parent\",res.category);setValue(\"variations\",res.variations);setValue(\"quantity\",res.quantity);setValue(\"originalPrice\",res.discountedPrice);setValue(\"salePrice\",res.price);setTag(categories);setProductData(res);setFiles(res.images);setImageUrl(res.images);console.log(res.variations);setVariations(res.variations);}}).catch(err=>{notifyError(\"There is a server error!\");});}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[id,setValue,isDrawerOpen]);useEffect(()=>{setChildren(watch(\"children\"));},[watch,children]);return{register,watch,handleSubmit,updateProductImages,onSubmit,errors,imageUrl,setImageUrl,tag,setTag,variations,setVariations};};export default useProductSubmit;","map":{"version":3,"names":["useContext","useEffect","useState","setArray","useForm","SidebarContext","ProductServices","notifyError","notifySuccess","useProductSubmit","id","imageUrl","setImageUrl","children","setChildren","productdata","setProductData","toUpdate","setToUpdate","tag","setTag","variations","setVariations","isDrawerOpen","closeDrawer","setIsUpdate","files","setFiles","register","handleSubmit","watch","setValue","clearErrors","formState","errors","updateProductImages","updateProduct","images","then","res","message","catch","err","onSubmit","data","discountedPrice","salePrice","_updateAddProduct","productData","sku","name","title","description","category","Array","from","Set","flatMap","x","split","quantity","price","originalPrice","undefined","addProduct","getProductById","console","log","categories","interest","forEach","v","k","push","_id","substring"],"sources":["/var/www/admin/src/hooks/useProductSubmit.js"],"sourcesContent":["import { useContext, useEffect, useState, setArray } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { SidebarContext } from \"../context/SidebarContext\";\nimport ProductServices from \"../services/ProductServices\";\nimport { notifyError, notifySuccess } from \"../utils/toast\";\n\nconst useProductSubmit = (id) => {\n  const [imageUrl, setImageUrl] = useState([]);\n  const [children, setChildren] = useState(\"\");\n  const [productdata, setProductData] = useState(null);\n  const [toUpdate, setToUpdate] = useState(false);\n  const [tag, setTag] = useState([]);\n  const [variations, setVariations] = useState([]);\n  const { isDrawerOpen, closeDrawer, setIsUpdate, files, setFiles } =\n    useContext(SidebarContext);\n\n  const {\n    register,\n    handleSubmit,\n    watch,\n    setValue,\n    clearErrors,\n    formState: { errors },\n  } = useForm();\n\n  const updateProductImages = (files, id) => {\n    ProductServices.updateProduct(id, { images: files })\n      .then((res) => {\n        setIsUpdate(true);\n        notifySuccess(res.message);\n      })\n      .catch((err) => notifyError(err.message));\n  };\n\n  const onSubmit = (data) => {\n    if (data.discountedPrice < data.salePrice) {\n      notifyError(\"SalePrice must be less then or equal of product price!\");\n      return;\n    }\n    _updateAddProduct(data);\n  };\n\n  const _updateAddProduct = (data) => {\n    const productData = {\n      sku: data.sku,\n      name: data.title,\n      description: data.description,\n      category: Array.from(new Set(tag.flatMap((x) => x.name.split(\", \")))),\n      quantity: data.quantity,\n      price: data.salePrice ? data.salePrice : data.originalPrice,\n      discountedPrice:\n        data.discountedPrice == undefined ? 0 : data.discountedPrice,\n    };\n\n    if (id) {\n      ProductServices.updateProduct(id, productData)\n        .then((res) => {\n          setIsUpdate(true);\n          notifySuccess(\"product updated\");\n        })\n        .catch((err) => notifyError(err.message));\n      closeDrawer();\n    } else {\n      ProductServices.addProduct(productData)\n        .then((res) => {\n          setIsUpdate(true);\n          notifySuccess(\"product added\");\n        })\n        .catch((err) => notifyError(err.message));\n      closeDrawer();\n    }\n  };\n\n  useEffect(() => {\n    if (!isDrawerOpen) {\n      setValue(\"sku\");\n      setValue(\"title\");\n      setValue(\"slug\");\n      setValue(\"description\");\n      setValue(\"parent\");\n      setValue(\"children\");\n      setValue(\"type\");\n      setValue(\"unit\");\n      setValue(\"quantity\");\n      setValue(\"originalPrice\");\n      setValue(\"salePrice\");\n      setImageUrl(\"\");\n      setChildren(\"\");\n      // setTag([]);\n      clearErrors(\"sku\");\n      clearErrors(\"title\");\n      clearErrors(\"slug\");\n      clearErrors(\"description\");\n      clearErrors(\"parent\");\n      clearErrors(\"children\");\n      clearErrors(\"type\");\n      clearErrors(\"unit\");\n      clearErrors(\"quantity\");\n      clearErrors(\"originalPrice\");\n      clearErrors(\"salePrice\");\n      clearErrors(\"tax1\");\n      clearErrors(\"tax2\");\n      return;\n    }\n\n    if (id) {\n      ProductServices.getProductById(id)\n        .then((res) => {\n          console.log(res);\n          if (res) {\n            var categories = [];\n            res.interest.forEach((v, k) => {\n              categories.push({ id: v._id, name: v.name });\n            });\n            setValue(\"sku\", res._id.substring(18, 26));\n            setValue(\"title\", res.name);\n            setValue(\"id\", res._id);\n            // setValue('slug', res.slug);\n            setValue(\"description\", res.description);\n            setValue(\"parent\", res.category);\n            setValue(\"variations\", res.variations);\n            setValue(\"quantity\", res.quantity);\n            setValue(\"originalPrice\", res.discountedPrice);\n            setValue(\"salePrice\", res.price);\n            setTag(categories);\n            setProductData(res);\n            setFiles(res.images);\n            setImageUrl(res.images);\n            console.log(res.variations);\n            setVariations(res.variations);\n          }\n        })\n        .catch((err) => {\n          notifyError(\"There is a server error!\");\n        });\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [id, setValue, isDrawerOpen]);\n\n  useEffect(() => {\n    setChildren(watch(\"children\"));\n  }, [watch, children]);\n\n  return {\n    register,\n    watch,\n    handleSubmit,\n    updateProductImages,\n    onSubmit,\n    errors,\n    imageUrl,\n    setImageUrl,\n    tag,\n    setTag,\n    variations,\n    setVariations,\n  };\n};\n\nexport default useProductSubmit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}