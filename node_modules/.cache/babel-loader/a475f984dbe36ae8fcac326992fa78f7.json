{"ast":null,"code":"import Cookies from\"js-cookie\";import{useContext,useState}from\"react\";import{useForm}from\"react-hook-form\";import{useHistory,useLocation}from\"react-router-dom\";import{AdminContext}from\"../context/AdminContext\";import AdminServices from\"../services/AdminServices\";import{notifyError,notifySuccess}from\"../utils/toast\";const useLoginSubmit=()=>{const[loading,setLoading]=useState(false);const{dispatch}=useContext(AdminContext);const history=useHistory();const location=useLocation();const{register,handleSubmit,formState:{errors}}=useForm();const onSubmit=_ref=>{let{name,email,verifyEmail,password,role}=_ref;setLoading(true);const cookieTimeOut=0.5;if(location.pathname===\"/login\"){AdminServices.loginAdmin({email,password}).then(res=>{if(res){setLoading(false);notifySuccess(\"Login Success!\");dispatch({type:\"USER_LOGIN\",payload:res[\"user\"]});res[\"user\"][\"token\"]=res[\"accesstoken\"];res[\"user\"][\"role\"]=\"admin\";Cookies.set(\"adminInfo\",JSON.stringify(res[\"user\"]),{expires:cookieTimeOut});history.replace(\"/\");}}).catch(err=>{notifyError(err?err.response.data.message:err.message);setLoading(false);});}if(location.pathname===\"/signup\"){AdminServices.registerAdmin({name,email,password,role}).then(res=>{if(res){setLoading(false);notifySuccess(\"Register Success!\");dispatch({type:\"USER_LOGIN\",payload:res});Cookies.set(\"adminInfo\",JSON.stringify(res),{expires:cookieTimeOut});history.replace(\"/\");}}).catch(err=>{notifyError(err?err.response.data.message:err.message);setLoading(false);});}if(location.pathname===\"/forgot-password\"){AdminServices.forgetPassword({verifyEmail}).then(res=>{setLoading(false);notifySuccess(res.message);}).catch(err=>{setLoading(false);notifyError(err?err.response.data.message:err.message);});}};return{onSubmit,register,handleSubmit,errors,loading};};export default useLoginSubmit;","map":{"version":3,"names":["Cookies","useContext","useState","useForm","useHistory","useLocation","AdminContext","AdminServices","notifyError","notifySuccess","useLoginSubmit","loading","setLoading","dispatch","history","location","register","handleSubmit","formState","errors","onSubmit","_ref","name","email","verifyEmail","password","role","cookieTimeOut","pathname","loginAdmin","then","res","type","payload","set","JSON","stringify","expires","replace","catch","err","response","data","message","registerAdmin","forgetPassword"],"sources":["/var/www/admin/src/hooks/useLoginSubmit.js"],"sourcesContent":["import Cookies from \"js-cookie\";\nimport { useContext, useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { AdminContext } from \"../context/AdminContext\";\nimport AdminServices from \"../services/AdminServices\";\nimport { notifyError, notifySuccess } from \"../utils/toast\";\n\nconst useLoginSubmit = () => {\n  const [loading, setLoading] = useState(false);\n  const { dispatch } = useContext(AdminContext);\n  const history = useHistory();\n  const location = useLocation();\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n  } = useForm();\n\n  const onSubmit = ({ name, email, verifyEmail, password, role }) => {\n    setLoading(true);\n    const cookieTimeOut = 0.5;\n\n    if (location.pathname === \"/login\") {\n      AdminServices.loginAdmin({ email, password })\n        .then((res) => {\n          if (res) {\n            setLoading(false);\n            notifySuccess(\"Login Success!\");\n            dispatch({ type: \"USER_LOGIN\", payload: res[\"user\"] });\n            res[\"user\"][\"token\"] = res[\"accesstoken\"];\n            res[\"user\"][\"role\"] = \"admin\";\n\n            Cookies.set(\"adminInfo\", JSON.stringify(res[\"user\"]), {\n              expires: cookieTimeOut,\n            });\n            history.replace(\"/\");\n          }\n        })\n        .catch((err) => {\n          notifyError(err ? err.response.data.message : err.message);\n          setLoading(false);\n        });\n    }\n\n    if (location.pathname === \"/signup\") {\n      AdminServices.registerAdmin({ name, email, password, role })\n        .then((res) => {\n          if (res) {\n            setLoading(false);\n            notifySuccess(\"Register Success!\");\n            dispatch({ type: \"USER_LOGIN\", payload: res });\n            Cookies.set(\"adminInfo\", JSON.stringify(res), {\n              expires: cookieTimeOut,\n            });\n            history.replace(\"/\");\n          }\n        })\n        .catch((err) => {\n          notifyError(err ? err.response.data.message : err.message);\n          setLoading(false);\n        });\n    }\n\n    if (location.pathname === \"/forgot-password\") {\n      AdminServices.forgetPassword({ verifyEmail })\n        .then((res) => {\n          setLoading(false);\n          notifySuccess(res.message);\n        })\n        .catch((err) => {\n          setLoading(false);\n          notifyError(err ? err.response.data.message : err.message);\n        });\n    }\n  };\n  return {\n    onSubmit,\n    register,\n    handleSubmit,\n    errors,\n    loading,\n  };\n};\n\nexport default useLoginSubmit;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}