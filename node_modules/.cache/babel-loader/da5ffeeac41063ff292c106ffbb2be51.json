{"ast":null,"code":"import React,{useEffect,useState,useContext}from\"react\";import axios from\"axios\";import{useDropzone}from\"react-dropzone\";import{FiUploadCloud}from\"react-icons/fi\";import{SidebarContext}from\"../../context/SidebarContext\";import{FiEdit,FiTrash2}from\"react-icons/fi\";import Tooltip from\"../../components/tooltip/Tooltip\";import useProductSubmit from\"../../hooks/useProductSubmit\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Uploader=_ref=>{let{id}=_ref;const{files,setFiles,closeDrawer}=useContext(SidebarContext);const{updateProductImages}=useProductSubmit(id);const{getRootProps,getInputProps}=useDropzone({accept:\"image/*\",multiple:false,maxSize:500000,onDrop:acceptedFiles=>{// setFiles((prevArr) => {\n//   return [\n//     ...prevArr,\n//     acceptedFiles.map((file) =>\n//       Object.assign(file, {\n//         preview: URL.createObjectURL(file),\n//       })\n//     ),\n//   ];\n// });\n// setFiles(\n//   acceptedFiles.map((file) =>\n//     Object.assign(file, {\n//       preview: URL.createObjectURL(file),\n//     })\n//   )\n// );\n}});// useEffect(() => {\n//   const uploadURL = uploadUrl;\n//   const uploadPreset = upload_Preset;\n//   if (files) {\n//     files.forEach((file) => {\n//       const formData = new FormData();\n//       formData.append(\"file\", file);\n//       formData.append(\"upload_preset\", uploadPreset);\n//       const storageRef = ref(storage, `/files/${file.name}`);\n//       const uploadTask = uploadBytesResumable(storageRef, file);\n//       uploadTask.on(\n//         \"state_changed\",\n//         (snapshot) => {\n//           const percent = Math.round(\n//             (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n//           );\n//           // update progress\n//           setPercent(percent);\n//         },\n//         (err) => console.log(err),\n//         () => {\n//           // download url\n//           getDownloadURL(uploadTask.snapshot.ref).then((url) => {\n//             console.log(url);\n//           });\n//         }\n//       );\n//       // axios({\n//       //   url: uploadURL,\n//       //   method: 'POST',\n//       //   headers: {\n//       //     'Content-Type': 'application/x-www-form-urlencoded',\n//       //   },\n//       //   data: formData,\n//       // })\n//       //   .then((res) => {\n//       //     setImageUrl(res.data.secure_url);\n//       //   })\n//       //   .catch((err) => console.log(err));\n//     });\n//   }\n//   // eslint-disable-next-line react-hooks/exhaustive-deps\n// }, [files]);\nvar thumbs;if(files.length>0){thumbs=files.map(function(file,i){if(typeof file===\"string\"||file instanceof String){return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[files.length>1?/*#__PURE__*/_jsx(\"div\",{onClick:()=>{files.splice(i,1);updateProductImages(files,id);},className:\"p-2 cursor-pointer text-gray-400 hover:text-red-600\",children:/*#__PURE__*/_jsx(Tooltip,{id:\"delete\",Icon:FiTrash2,title:\"Delete\",bgColor:\"#EF4444\"})}):\"\",/*#__PURE__*/_jsx(\"img\",{className:\"inline-flex border-2 border-gray-100 w-24 max-h-24\",src:file})]})},i);}if(file[0]==undefined)return;return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{onClick:()=>{console.log(i);files.splice(i,1);setFiles(prevArr=>{return[...prevArr,files];});},className:\"p-2 cursor-pointer text-gray-400 hover:text-red-600\",children:/*#__PURE__*/_jsx(Tooltip,{id:\"delete\",Icon:FiTrash2,title:\"Delete\",bgColor:\"#EF4444\"})}),/*#__PURE__*/_jsx(\"img\",{className:\"inline-flex border-2 border-gray-100 w-24 max-h-24\",src:file[0].preview})]})},i);});}// useEffect(() => {\n//   if (imageUrl) {\n//     var tt = imageUrl.map(function (file, i) {\n//       return (\n//         <div key={i}>\n//           <div>\n//             <img\n//               className=\"inline-flex border-2 border-gray-100 w-24 max-h-24\"\n//               src={file}\n//             />\n//           </div>\n//         </div>\n//       );\n//     });\n//     thumbs.push(tt);\n//   }\n// }, []);\nuseEffect(()=>()=>{// Make sure to revoke the data uris to avoid memory leaks\nfiles.forEach(file=>URL.revokeObjectURL(file.preview));},[files]);return/*#__PURE__*/_jsxs(\"div\",{className:\"w-full text-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md cursor-pointer\",...getRootProps(),children:[/*#__PURE__*/_jsx(\"input\",{...getInputProps()}),/*#__PURE__*/_jsx(\"span\",{className:\"mx-auto flex justify-center\",children:/*#__PURE__*/_jsx(FiUploadCloud,{className:\"text-3xl text-green-500\"})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm mt-2\",children:\"Drag your image here\"}),/*#__PURE__*/_jsx(\"em\",{className:\"text-xs text-gray-400\",children:\"(Only *.jpeg and *.png images will be accepted)\"})]}),/*#__PURE__*/_jsx(\"aside\",{className:\"flex flex-row flex-wrap mt-4\",children:thumbs})]});};export default Uploader;","map":{"version":3,"names":["React","useEffect","useState","useContext","axios","useDropzone","FiUploadCloud","SidebarContext","FiEdit","FiTrash2","Tooltip","useProductSubmit","jsx","_jsx","jsxs","_jsxs","Uploader","_ref","id","files","setFiles","closeDrawer","updateProductImages","getRootProps","getInputProps","accept","multiple","maxSize","onDrop","acceptedFiles","thumbs","length","map","file","i","String","children","onClick","splice","className","Icon","title","bgColor","src","undefined","console","log","prevArr","preview","forEach","URL","revokeObjectURL"],"sources":["/var/www/admin/src/components/image-uploader/Uploader.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport axios from \"axios\";\nimport { useDropzone } from \"react-dropzone\";\nimport { FiUploadCloud } from \"react-icons/fi\";\nimport { SidebarContext } from \"../../context/SidebarContext\";\nimport { FiEdit, FiTrash2 } from \"react-icons/fi\";\nimport Tooltip from \"../../components/tooltip/Tooltip\";\nimport useProductSubmit from \"../../hooks/useProductSubmit\";\n\nconst Uploader = ({ id }) => {\n  const { files, setFiles, closeDrawer } = useContext(SidebarContext);\n\n  const { updateProductImages } = useProductSubmit(id);\n\n  const { getRootProps, getInputProps } = useDropzone({\n    accept: \"image/*\",\n    multiple: false,\n    maxSize: 500000,\n    onDrop: (acceptedFiles) => {\n      // setFiles((prevArr) => {\n      //   return [\n      //     ...prevArr,\n      //     acceptedFiles.map((file) =>\n      //       Object.assign(file, {\n      //         preview: URL.createObjectURL(file),\n      //       })\n      //     ),\n      //   ];\n      // });\n      // setFiles(\n      //   acceptedFiles.map((file) =>\n      //     Object.assign(file, {\n      //       preview: URL.createObjectURL(file),\n      //     })\n      //   )\n      // );\n    },\n  });\n\n  // useEffect(() => {\n  //   const uploadURL = uploadUrl;\n  //   const uploadPreset = upload_Preset;\n  //   if (files) {\n  //     files.forEach((file) => {\n  //       const formData = new FormData();\n  //       formData.append(\"file\", file);\n  //       formData.append(\"upload_preset\", uploadPreset);\n  //       const storageRef = ref(storage, `/files/${file.name}`);\n  //       const uploadTask = uploadBytesResumable(storageRef, file);\n  //       uploadTask.on(\n  //         \"state_changed\",\n  //         (snapshot) => {\n  //           const percent = Math.round(\n  //             (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n  //           );\n\n  //           // update progress\n  //           setPercent(percent);\n  //         },\n  //         (err) => console.log(err),\n  //         () => {\n  //           // download url\n  //           getDownloadURL(uploadTask.snapshot.ref).then((url) => {\n  //             console.log(url);\n  //           });\n  //         }\n  //       );\n  //       // axios({\n  //       //   url: uploadURL,\n  //       //   method: 'POST',\n  //       //   headers: {\n  //       //     'Content-Type': 'application/x-www-form-urlencoded',\n  //       //   },\n  //       //   data: formData,\n  //       // })\n  //       //   .then((res) => {\n  //       //     setImageUrl(res.data.secure_url);\n  //       //   })\n  //       //   .catch((err) => console.log(err));\n  //     });\n  //   }\n  //   // eslint-disable-next-line react-hooks/exhaustive-deps\n  // }, [files]);\n  var thumbs;\n\n  if (files.length > 0) {\n    thumbs = files.map(function (file, i) {\n      if (typeof file === \"string\" || file instanceof String) {\n        return (\n          <div key={i}>\n            <div>\n              {files.length > 1 ? (\n                <div\n                  onClick={() => {\n                    files.splice(i, 1);\n                    updateProductImages(files, id);\n                  }}\n                  className=\"p-2 cursor-pointer text-gray-400 hover:text-red-600\"\n                >\n                  <Tooltip\n                    id=\"delete\"\n                    Icon={FiTrash2}\n                    title=\"Delete\"\n                    bgColor=\"#EF4444\"\n                  />\n                </div>\n              ) : \"\"}\n              <img\n                className=\"inline-flex border-2 border-gray-100 w-24 max-h-24\"\n                src={file}\n              />\n            </div>\n          </div>\n        );\n      }\n      if (file[0] == undefined) return;\n      return (\n        <div key={i}>\n          <div>\n            <div\n              onClick={() => {\n                console.log(i);\n                files.splice(i, 1);\n                setFiles((prevArr) => {\n                  return [...prevArr, files];\n                });\n              }}\n              className=\"p-2 cursor-pointer text-gray-400 hover:text-red-600\"\n            >\n              <Tooltip\n                id=\"delete\"\n                Icon={FiTrash2}\n                title=\"Delete\"\n                bgColor=\"#EF4444\"\n              />\n            </div>\n            <img\n              className=\"inline-flex border-2 border-gray-100 w-24 max-h-24\"\n              src={file[0].preview}\n            />\n          </div>\n        </div>\n      );\n    });\n  }\n\n  // useEffect(() => {\n  //   if (imageUrl) {\n  //     var tt = imageUrl.map(function (file, i) {\n  //       return (\n  //         <div key={i}>\n  //           <div>\n  //             <img\n  //               className=\"inline-flex border-2 border-gray-100 w-24 max-h-24\"\n  //               src={file}\n  //             />\n  //           </div>\n  //         </div>\n  //       );\n  //     });\n  //     thumbs.push(tt);\n  //   }\n  // }, []);\n  useEffect(\n    () => () => {\n      // Make sure to revoke the data uris to avoid memory leaks\n      files.forEach((file) => URL.revokeObjectURL(file.preview));\n    },\n    [files]\n  );\n\n  return (\n    <div className=\"w-full text-center\">\n      <div\n        className=\"px-6 pt-5 pb-6 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md cursor-pointer\"\n        {...getRootProps()}\n      >\n        <input {...getInputProps()} />\n        <span className=\"mx-auto flex justify-center\">\n          <FiUploadCloud className=\"text-3xl text-green-500\" />\n        </span>\n        <p className=\"text-sm mt-2\">Drag your image here</p>\n        <em className=\"text-xs text-gray-400\">\n          (Only *.jpeg and *.png images will be accepted)\n        </em>\n      </div>\n      <aside className=\"flex flex-row flex-wrap mt-4\">\n        {thumbs}\n        {/* {imageUrl ? (\n          <img\n            className=\"inline-flex border rounded-md border-gray-100 dark:border-gray-600 w-24 max-h-24 p-2\"\n            src={imageUrl}\n            alt=\"product\"\n          />\n        ) : (\n          thumbs\n        )} */}\n      </aside>\n    </div>\n  );\n};\n\nexport default Uploader;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,CAAEC,UAAU,KAAQ,OAAO,CAC9D,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,WAAW,KAAQ,gBAAgB,CAC5C,OAASC,aAAa,KAAQ,gBAAgB,CAC9C,OAASC,cAAc,KAAQ,8BAA8B,CAC7D,OAASC,MAAM,CAAEC,QAAQ,KAAQ,gBAAgB,CACjD,MAAO,CAAAC,OAAO,KAAM,kCAAkC,CACtD,MAAO,CAAAC,gBAAgB,KAAM,8BAA8B,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAE5D,KAAM,CAAAC,QAAQ,CAAGC,IAAA,EAAY,IAAX,CAAEC,EAAG,CAAC,CAAAD,IAAA,CACtB,KAAM,CAAEE,KAAK,CAAEC,QAAQ,CAAEC,WAAY,CAAC,CAAGlB,UAAU,CAACI,cAAc,CAAC,CAEnE,KAAM,CAAEe,mBAAoB,CAAC,CAAGX,gBAAgB,CAACO,EAAE,CAAC,CAEpD,KAAM,CAAEK,YAAY,CAAEC,aAAc,CAAC,CAAGnB,WAAW,CAAC,CAClDoB,MAAM,CAAE,SAAS,CACjBC,QAAQ,CAAE,KAAK,CACfC,OAAO,CAAE,MAAM,CACfC,MAAM,CAAGC,aAAa,EAAK,CACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA,CAEJ,CAAC,CAAC,CAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAI,CAAAC,MAAM,CAEV,GAAIX,KAAK,CAACY,MAAM,CAAG,CAAC,CAAE,CACpBD,MAAM,CAAGX,KAAK,CAACa,GAAG,CAAC,SAAUC,IAAI,CAAEC,CAAC,CAAE,CACpC,GAAI,MAAO,CAAAD,IAAI,GAAK,QAAQ,EAAIA,IAAI,WAAY,CAAAE,MAAM,CAAE,CACtD,mBACEtB,IAAA,QAAAuB,QAAA,cACErB,KAAA,QAAAqB,QAAA,EACGjB,KAAK,CAACY,MAAM,CAAG,CAAC,cACflB,IAAA,QACEwB,OAAO,CAAEA,CAAA,GAAM,CACblB,KAAK,CAACmB,MAAM,CAACJ,CAAC,CAAE,CAAC,CAAC,CAClBZ,mBAAmB,CAACH,KAAK,CAAED,EAAE,CAAC,CAChC,CAAE,CACFqB,SAAS,CAAC,qDAAqD,CAAAH,QAAA,cAE/DvB,IAAA,CAACH,OAAO,EACNQ,EAAE,CAAC,QAAQ,CACXsB,IAAI,CAAE/B,QAAS,CACfgC,KAAK,CAAC,QAAQ,CACdC,OAAO,CAAC,SAAS,CAClB,CAAC,CACC,CAAC,CACJ,EAAE,cACN7B,IAAA,QACE0B,SAAS,CAAC,oDAAoD,CAC9DI,GAAG,CAAEV,IAAK,CACX,CAAC,EACC,CAAC,EAtBEC,CAuBL,CAAC,CAEV,CACA,GAAID,IAAI,CAAC,CAAC,CAAC,EAAIW,SAAS,CAAE,OAC1B,mBACE/B,IAAA,QAAAuB,QAAA,cACErB,KAAA,QAAAqB,QAAA,eACEvB,IAAA,QACEwB,OAAO,CAAEA,CAAA,GAAM,CACbQ,OAAO,CAACC,GAAG,CAACZ,CAAC,CAAC,CACdf,KAAK,CAACmB,MAAM,CAACJ,CAAC,CAAE,CAAC,CAAC,CAClBd,QAAQ,CAAE2B,OAAO,EAAK,CACpB,MAAO,CAAC,GAAGA,OAAO,CAAE5B,KAAK,CAAC,CAC5B,CAAC,CAAC,CACJ,CAAE,CACFoB,SAAS,CAAC,qDAAqD,CAAAH,QAAA,cAE/DvB,IAAA,CAACH,OAAO,EACNQ,EAAE,CAAC,QAAQ,CACXsB,IAAI,CAAE/B,QAAS,CACfgC,KAAK,CAAC,QAAQ,CACdC,OAAO,CAAC,SAAS,CAClB,CAAC,CACC,CAAC,cACN7B,IAAA,QACE0B,SAAS,CAAC,oDAAoD,CAC9DI,GAAG,CAAEV,IAAI,CAAC,CAAC,CAAC,CAACe,OAAQ,CACtB,CAAC,EACC,CAAC,EAvBEd,CAwBL,CAAC,CAEV,CAAC,CAAC,CACJ,CAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAjC,SAAS,CACP,IAAM,IAAM,CACV;AACAkB,KAAK,CAAC8B,OAAO,CAAEhB,IAAI,EAAKiB,GAAG,CAACC,eAAe,CAAClB,IAAI,CAACe,OAAO,CAAC,CAAC,CAC5D,CAAC,CACD,CAAC7B,KAAK,CACR,CAAC,CAED,mBACEJ,KAAA,QAAKwB,SAAS,CAAC,oBAAoB,CAAAH,QAAA,eACjCrB,KAAA,QACEwB,SAAS,CAAC,sGAAsG,IAC5GhB,YAAY,CAAC,CAAC,CAAAa,QAAA,eAElBvB,IAAA,aAAWW,aAAa,CAAC,CAAC,CAAG,CAAC,cAC9BX,IAAA,SAAM0B,SAAS,CAAC,6BAA6B,CAAAH,QAAA,cAC3CvB,IAAA,CAACP,aAAa,EAACiC,SAAS,CAAC,yBAAyB,CAAE,CAAC,CACjD,CAAC,cACP1B,IAAA,MAAG0B,SAAS,CAAC,cAAc,CAAAH,QAAA,CAAC,sBAAoB,CAAG,CAAC,cACpDvB,IAAA,OAAI0B,SAAS,CAAC,uBAAuB,CAAAH,QAAA,CAAC,iDAEtC,CAAI,CAAC,EACF,CAAC,cACNvB,IAAA,UAAO0B,SAAS,CAAC,8BAA8B,CAAAH,QAAA,CAC5CN,MAAM,CAUF,CAAC,EACL,CAAC,CAEV,CAAC,CAED,cAAe,CAAAd,QAAQ"},"metadata":{},"sourceType":"module"}